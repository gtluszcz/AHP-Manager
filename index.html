<!DOCTYPE html>
<html>
    <head>
        <title>AHP Manager</title>
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="fonts/fonts.css">
    </head>
    <body>
        <h1 class="title">AHP manager</h1>
        <h3 class="subtitle">
            made by:
            <a href="https://github.com/gtluszcz">@gtluszcz</a>
            <a href="https://github.com/dczajkowski">@DCzajkowski</a>
        </h3>

        <div id="app">
            <div class="alternatives">
                <div class="controls-wrap">
                    <button class="left big" @click="subtract" :disabled="alternatives.length === 0">-</button>
                    <button class="right big" @click="add">+</button>
                </div>

                <input
                    type="text"
                    class="alt alternative"
                    v-for="alter in alternatives"
                    v-model="alter.value"
                    placeholder="alternative"
                >
            </div>

            <div class="row">
                <div class="links">
                    <recursive-madness
                        :subtree="tree"
                        :initial-criterion="tree.name"
                        :key="tree.name"
                    ></recursive-madness>
                </div>
                <div class="rechts">
                    <question
                        :subtree="tree"
                        :initial-criterion="tree.name"
                        :key="tree.name"
                    ></question>
                    <question2
                        :subtree="tree"
                        :initial-criterion="tree.name"
                        :alternatives="alternatives"
                        :key="Math.random()"
                    ></question2>
                </div>
            </div>
            <div class="result">
                <pre v-text="renderedTree()"></pre>
            </div>
        </div>

        <template id="recursive-madness">
            <div class="level">
                <div class="row">
                    <input type="text" class="cell" v-model="criterion" @blur="onBlur" placeholder="Enter subcriteria">
                    <div>
                        <button
                            class="left"
                            @click="subtract(subtree.name)"
                            v-if="subtree.criteria !== null && this.$parent.subtree != null"
                        >-</button>
                        <button
                            class="right"
                            :class="{ round: this.$parent.subtree == null }"
                            @click="add"
                            v-if="subtree.criteria !== null"
                        >+</button>
                    </div>
                </div>

                <div v-if="subtree !== null">
                    <div v-for="criterion in subtree.criteria">
                        <recursive-madness
                            :subtree="criterion"
                            :initial-criterion="criterion.name"
                            :key="criterion.name"
                        ></recursive-madness>
                    </div>
                </div>
            </div>
        </template>

        <template id="question">
            <div class="wrap">
                <div class="parent" v-if="subtree.criteria.length > 1">based on: {{ subtree.name }}</div>
                <div class="div" v-for="i in subtree.criteria">
                    <div class="div" v-for="j in subtree.criteria">
                        <div class="row" v-if="subtree.criteria.indexOf(j) > subtree.criteria.indexOf(i)">
                            <div class="alt">{{ i.name }}</div>
                            <input
                                type="text"
                                class="alt number"
                                @change="refresh(
                                    subtree,
                                    subtree.criteria.indexOf(i),
                                    subtree.criteria.indexOf(j),
                                    $event
                                )"
                                v-model.number="subtree.matrix[
                                    subtree.criteria.indexOf(i)
                                    * subtree.criteria.length
                                    + subtree.criteria.indexOf(j)
                                ].value"
                                placeholder="0"
                            >
                            <div class="alt">{{ j.name }}</div>
                        </div>
                    </div>
                </div>

                <div v-if="subtree !== null">
                    <div v-for="criterion in subtree.criteria">
                        <question
                            :subtree="criterion"
                            :initial-criterion="criterion.name"
                            :key="criterion.name"
                        ></question>
                    </div>
                </div>
            </div>
        </template>

        <template id="question2">
            <div class="wrap">
                <div v-if="subtree.criteria.length == 0">
                    <div class="parent" v-if="alternatives.length > 1">based on: {{ subtree.name }}</div>
                    <div class="div" v-for="i in alternatives">
                        <div class="div" v-for="j in alternatives">
                            <div
                                class="row"
                                v-if="alternatives.indexOf(j) > alternatives.indexOf(i)"
                            >
                                <div class="alt">{{ i.value }}</div>
                                <input
                                    type="text"
                                    class="alt number"
                                    @change="refresh(
                                        subtree,
                                        alternatives.indexOf(i),
                                        alternatives.indexOf(j),
                                        $event
                                    )"
                                    v-model.number="subtree.matrix[
                                        alternatives.indexOf(i)
                                        * alternatives.length
                                        + alternatives.indexOf(j)
                                    ].value"
                                    placeholder="0"
                                >
                                <div class="alt">{{ j.value }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="subtree !== null">
                    <div v-for="criterion in subtree.criteria">
                        <question2
                            :subtree="criterion"
                            :initial-criterion="criterion.name"
                            :alternatives="alternatives"
                            :key="criterion.name"
                        ></question2>
                    </div>
                </div>
            </div>
        </template>

        <script src="vue.js"></script>
        <script src="app.js"></script>
    </body>
</html>
